## **一 系统分层架构**

### 1.1 表示层（前端）

- 用户通过 Web 界面上传文档和提问。
- 技术选型：HTML/CSS/JavaScript，或框架（如 React、Vue.js、Streamlit(测试使用)）。

### 1.2 业务逻辑层

- 实现上传、文档处理、知识库构建、问答等核心逻辑。
- 技术选型：Python（Langchain、Langgraph、FastAPI）。

### 1.3 数据层

- 存储用户上传的文档、知识库向量、日志信息等。
- 技术选型：关系型数据库（如 MySQL）、向量数据库（如 Milvus）。

------

## **二 模块划分**

结合功能架构，明确各模块的技术实现

### 2.1 **用户模块**

- 上传文档：前端通过 HTTP POST 上传文档到后端。
- 提问：通过 HTTP POST 将问题发送给后端问答服务。

### 2.2 数据预处理模块

- 处理不同类型的文件（md、docx、pdf）:
  - 技术选型：使用 Python 的 `markdown`、`python-docx`、`PyPDF2` 等库。
  - 流程：上传的文档存入本地数据库，再解析为md统一格式的文本。
- 处理视频类的文件（MP4）:
  - 技术选项：
  - 流程：

### 2.3 **RAG 系统模块**

- 创建知识库
- 知识库管理
- 知识库问答


------

## 三 数据流设计

设计系统中数据的流动过程，例如：

用户上传文档：

- 前端通过 POST 请求上传文档。
- 文档发送到后端的数据预处理模块，解析并存入数据库。

用户提问：

- 用户通过前端发送问题到后端。
- 后端调用知识库问答模块：
  - 检索相关文档（向量数据库）。
  - 使用生成式模型生成答案。
- 将答案返回给前端展示。

------

## **四 部署架构**

设计系统的部署方案，例如：

### 4.1 **单体部署**

- 前后端整合，部署在一个服务器上（适合初期开发）。

### 4.2 分布式部署

- 使用微服务架构，将不同模块拆分为独立服务：
  - 用户模块部署在 Web 服务器上（如 Nginx）。
  - 数据预处理模块和 RAG 模块通过 API 网关交互。
  - 向量数据库和主数据库单独部署。
- 使用 Docker 容器化部署，配合 Kubernetes 进行编排。

部署架构图如下：

```
+-------------------+          +-------------------+         +-------------------+
|   用户前端         |          | 数据预处理服务       |         | RAG 系统服务       |
|   (React/Vue.js)  | <------> | (Flask/FastAPI)   | <-----> | (知识库/生成器)     |
+-------------------+          +-------------------+         +-------------------+
                                          ^
                                          |
                                +-------------------+
                                |   数据存储服务    |
                                | (MySQL/Milvus)    |
                                +-------------------+
```

------

## **五 非功能性需求**

### 4.3 **性能优化**

- 使用缓存（如 Redis）存储热点数据。
- 异步处理文档解析和向量化操作（如 Celery + RabbitMQ）。

### 4.4 **高可用性**

- 数据库设置主从复制，避免单点故障。
- 使用负载均衡（如 Nginx、AWS ELB）分发请求。

### 4.5 **安全性**

- 文档上传限制文件类型和大小。
- 提问接口验证用户身份（如 JWT）。